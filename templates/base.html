<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Sri Vinayaga Stores</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <meta name="theme-color" content="#2b7a78">
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
  <style>
    .flash-area {
        margin-bottom: 15px;
    }

    .flash {
        padding: 10px 15px;
        border-radius: 6px;
        font-weight: bold;
        font-size: 15px;
        margin-bottom: 8px;

        opacity: 0;              /* initially hidden */
        animation: fadeIn 0.8s forwards;
    }

    /* ðŸŸ¥ Red Flash Message */
    .flash.error, .flash.danger, .flash.red {
        background: #ffe5e5;
        color: #b30000;
        border-left: 4px solid #ff0000;
        box-shadow: 0 2px 5px rgba(255, 0, 0, 0.2);
    }

    /* ðŸŸ© Green Flash (Success) */
    .flash.success, .flash.green {
        background: #e6ffed;
        color: #0d8a32;
        border-left: 4px solid #0bc650;
        box-shadow: 0 2px 5px rgba(0, 200, 80, 0.2);
    }

    /* Fade-out animation */
    .fade-out {
        animation: fadeOut 1s forwards;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-5px); }
        to   { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeOut {
        from { opacity: 1; }
        to   { opacity: 0; transform: translateY(-5px); }
    }
  </style>

</head>
<body>
  <div class="layout">
    <nav id="sideNav" class="sidenav">
      <button id="navToggle" class="nav-toggle">â˜°</button>
      <ul>
        <li><a href="{{ url_for('home') }}">Home</a></li>
        <li><a href="{{ url_for('customer_login') }}">Customer</a></li>
        <li><a href="{{ url_for('admin_security') }}">Admin</a></li>
        <li>
          <button 
            id="install-btn"
            disabled
            style="
              width: 70%;
              padding: 10px 14px;
              margin-top: 8px;
              background: #2b7a78;
              color: white;
              border: 2px solid #ffffff;
              border-radius: 6px;
              cursor: not-allowed;
              opacity: 0.5;
              font-size: 15px;
              text-align: center;
            ">
            Install App
          </button>
        </li>
        <li>
        <button id="share-btn"
          style="
            position: fixed;
            width: 8%;
            bottom: 80px;
            left: 20px;
            padding: 10px 14px;
            font-size: 15px;
            background: #2b7a78;
            color: #ffffff;       /* brighter text */
            border: 2.4px solid #ffffff;  /* bright border */
            border-radius: 6px;
            cursor: pointer;
            opacity: 1;           /* remove dimming */
            text-align: center;
            z-index: 1000;
            transition: 0.3s;     /* smooth hover effect */
          "
          onmouseover="this.style.opacity='0.9'"
          onmouseout="this.style.opacity='1'">
          Share
        </button>

        </li>
      </ul>
    </nav>

    <main class="main">
      <header class="site-header">
        <h1 class="shop-name">Sri Vinayaga Stores</h1>
        <p><center><i>Pillaiyar Kuppam, Vellore - 09.</i></center><p>
        <div class="quote-marquee"><marquee behavior="scroll" direction="left"><b><i>fresh daily groceries &nbsp &nbsp &nbsp &nbsp â€¢ &nbsp &nbsp &nbsp &nbsp friendy service &nbsp &nbsp &nbsp &nbsp â€¢ &nbsp &nbsp &nbsp &nbsp  quality you can trust</i></b></marquee></div>
        <div class="top-links">
          {% if session.get('role') == 'admin' %}
            <a class="badge" href="{{ url_for('admin_dashboard') }}">Admin: {{ session.get('admin_name') }}</a>
            <a class="btn" href="{{ url_for('admin_logout') }}">Logout</a>
          {% elif session.get('role') == 'customer' %}
            <a class="badge" href="{{ url_for('customer_dashboard') }}">Customer: {{ session.get('customer_name') }}</a>
            <a class="btn" href="{{ url_for('customer_logout') }}">Logout</a>
          {% else %}
            <!-- not logged in -->
          {% endif %}
        </div>
      </header>

      <section class="content">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-area">
            {% for cat, msg in messages %}
              <div class="flash {{cat}}">{{ msg }}</div>
            {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
      </section>

      <footer class="site-footer">
        <p>Â© Sri Vinayaga Stores - 2025 - [Site Under Development & Testing]</p>
      </footer>
    </main>
  </div>

<script src="{{ url_for('static', filename='js/main.js') }}"></script>
<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker
        .register("{{ url_for('static', filename='service-worker.js') }}")
        .then(reg => console.log("Service Worker registered!", reg))
        .catch(err => console.log("Service Worker failed:", err));
    });
  }
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register("{{ url_for('static', filename='service-worker.js') }}")
        .then(() => console.log("Service Worker Registered"))
        .catch(err => console.error("Service Worker registration failed:", err));
    }
  </script>
  <script>
  // SHARE BUTTON FUNCTIONALITY
    document.getElementById("share-btn").addEventListener("click", async () => {

        const shareData = {
            title: "Check this app!",
            text: "Install this app â€“ Shop Online!",
            url: window.location.origin
        };

        if (navigator.share) {
            try {
                await navigator.share(shareData);
                console.log("Shared successfully");
            } catch (err) {
                console.log("Share canceled");
            }
        } else {
            // Fallback: Copy link to clipboard
            navigator.clipboard.writeText(window.location.origin);
            alert("Link copied to clipboard!");
        }
    });
  </script>
  <script>
    let deferredPrompt;

    window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;

        const btn = document.getElementById("install-btn");
        btn.disabled = false;
        btn.style.opacity = "1";
        btn.style.cursor = "pointer";
    });

    document.getElementById("install-btn").addEventListener("click", async () => {
        if (!deferredPrompt) return;

        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log("Install result:", outcome);

        deferredPrompt = null;
    });
  </script>

  <script>
  document.addEventListener("DOMContentLoaded", function() {
      const flashMessages = document.querySelectorAll(".flash");

      flashMessages.forEach(msg => {
          let text = msg.innerText.toLowerCase();

          // Default timeout 10 seconds
          let hideTime = 10000;

          // If message contains CUID or AUID => 30 seconds
          if (text.includes("cuid") || text.includes("auid")) {
              hideTime = 30000;
          }

          setTimeout(() => {
              msg.classList.add("fade-out");
          }, hideTime);
      });
  });
  </script>

</body>
</html>
